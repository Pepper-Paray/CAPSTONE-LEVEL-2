<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Soothing Sounds - Mindcare</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: linear-gradient(135deg, #232946 0%, #121629 100%);
      color: #e0e6f7;
    }
    .container {
      background: #232946;
      border-radius: 18px;
      box-shadow: 0 4px 32px #12162944;
      padding-bottom: 24px;
    }
    .tabs {
      background: #232946;
      border-radius: 8px;
    }
    .tab, .tab.active {
      color: #a8edea;
      background: transparent;
    }
    .tab.active {
      color: #43cea2;
      font-weight: bold;
      border-bottom: 2px solid #43cea2;
    }
    h1, h2, b {
      color: #a8edea;
    }
    /* Card backgrounds */
    [style*="background:#f7f7ff"], [style*="background:#e0f7fa"], [style*="background:#fff"], [style*="background:#fff3cd"] {
      background: #232946 !important;
      color: #e0e6f7 !important;
      border: 1px solid #23294622 !important;
    }
    /* Affirmation glow */
    .affirmation-active {
      animation: glow-dark 1.5s ease-in-out infinite;
    }
    @keyframes glow-dark {
      0% { text-shadow: 0 0 8px #43cea2, 0 0 16px #232946, 0 0 24px #232946; }
      100% { text-shadow: 0 0 16px #a8edea, 0 0 32px #43cea2, 0 0 48px #232946; }
    }
    /* Inputs, buttons */
    input, textarea, select {
      background: #181b2a;
      color: #e0e6f7;
      border: 1px solid #a8edea;
    }
    input:focus, textarea:focus, select:focus {
      border: 2px solid #43cea2;
      outline: none;
      background: #232946;
    }
    button {
      background: #43cea2;
      color: #232946;
      border: none;
      border-radius: 8px;
      font-weight: 600;
    }
    button:hover {
      background: #a8edea;
      color: #232946;
    }
    /* MindMate Chat Styles (dark) */
    #mindmateChat {
      background: #181b2a !important;
      color: #e0e6f7;
      box-shadow: 0 4px 24px #23294699;
    }
    #chatWindow {
      background: #232946;
    }
    .chat-bubble.ai {
      background: #232946;
      color: #a8edea;
      border-left: 4px solid #43cea2;
    }
    .chat-bubble.user {
      background: #181b2a;
      color: #e0e6f7;
      border-right: 4px solid #a8edea;
    }
    #chatInput {
      background: #232946;
      color: #e0e6f7;
      border: 1px solid #a8edea;
    }
    #chatInput:focus {
      border:2px solid #43cea2; box-shadow:0 0 0 2px #43cea255;
    }
    #typingIndicator {
      color: #a8edea;
    }
    /* Floating shapes (dark) */
    .floating-shape {
      opacity: 0.22;
      filter: brightness(0.7) saturate(1.2);
    }
    /* Visualizer */
    #visualizer {
      background: #181b2a;
    }
    .bar {
      background: linear-gradient(135deg, #43cea2 60%, #a8edea 100%);
    }
    /* Modal backgrounds */
    #gratitudeModal, #visualizeModal {
      background: rgba(35,41,70,0.92) !important;
    }
    .gratitude-popup, [style*="background:#fff;"] {
      background: #232946 !important;
      color: #e0e6f7 !important;
      box-shadow: 0 4px 24px #12162955 !important;
    }
    /* API key section */
    #apiKeySection {
      background: #181b2a !important;
      color: #a8edea !important;
      border: 1px solid #23294655 !important;
    }
    #particles {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      z-index: 0;
      pointer-events: none;
    }
    #visualizer {
      width: 100%;
      height: 32px;
      background: #e0f7fa;
      border-radius: 8px;
      margin: 12px 0 0 0;
      display: flex;
      align-items: flex-end;
      gap: 2px;
      overflow: hidden;
    }
    .bar {
      width: 6px;
      background: linear-gradient(135deg, #5e60ce 60%, #a8edea 100%);
      border-radius: 4px 4px 0 0;
      transition: height 0.2s;
    }
    #gratitudeModal {
      display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(168,237,234,0.85);z-index:1000;align-items:center;justify-content:center;
    }
    /* Floating shapes */
    .floating-shape {
      position: fixed;
      border-radius: 50%;
      pointer-events: none;
      animation: float 6s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    /* Affirmation glow */
    .affirmation-active {
      animation: glow 1.5s ease-in-out infinite;
    }
    @keyframes glow {
      0% { text-shadow: 0 0 5px #5e60ce, 0 0 10px #5e60ce, 0 0 15px #43cea2, 0 0 20px #43cea2; }
      100% { text-shadow: 0 0 10px #5e60ce, 0 0 20px #5e60ce, 0 0 30px #43cea2, 0 0 40px #43cea2; }
    }
  </style>
</head>
<body>
  <!-- Immersive Floating Shapes -->
  <div class="floating-shape" style="top:12%;left:8%;width:60px;height:60px;background:radial-gradient(circle,#fed6e3 60%,#fff0 100%);"></div>
  <div class="floating-shape" style="top:70%;left:80%;width:44px;height:44px;background:radial-gradient(circle,#a8edea 60%,#fff0 100%);"></div>
  <div class="floating-shape" style="top:40%;left:60%;width:36px;height:36px;background:radial-gradient(circle,#b8c0ff 60%,#fff0 100%);"></div>
  <canvas id="particles"></canvas>
  <div class="container">
    <h1>Soothing Sounds</h1>
    <div class="tabs">
      <a class="tab" href="index.html">Home</a>
      <a class="tab active" href="#">Soothing Sounds</a>
      <a class="tab" href="puzzles.html">Puzzles</a>
    </div>
    <div style="margin:18px 0 0 0; font-size:1.08em; color:#43cea2; background:#f7f7ff; border-radius:8px; padding:10px 16px;">
      <b>Therapist Collaboration Mode:</b> <span style="font-size:0.97em;color:#4a4a4a;">You can use this page together with your therapist. Share your favorite sounds, affirmations, and breathing exercises in session. Your therapist can guide you to select calming sounds, practice breathing, or reflect on affirmations together. Use the journal to note insights or feelings during therapy.</span>
      <br><button id="exportSessionBtn" style="margin-top:10px;background:#5e60ce;color:#fff;border:none;border-radius:6px;padding:6px 18px;font-size:1em;cursor:pointer;">Export Session Notes</button>
      <span id="exportMsg" style="margin-left:12px;color:#43cea2;"></span>
    </div>
    <div style="margin:18px 0 0 0; font-size:1.08em; color:#5e60ce; background:#f7f7ff; border-radius:8px; padding:10px 16px;">
      <b>Welcome to your calm space.</b> Let these sounds help you relax, focus, or just take a break. You are safe and supported here.
    </div>
    <!-- AI Mood Check-In -->
    <div style="margin:18px 0 0 0; font-size:1.08em; color:#4a4a4a; background:#e0f7fa; border-radius:8px; padding:10px 16px;">
      <b>Mood Check-In:</b>
      <span id="moodText" style="display:block;margin:8px 0 0 0;"></span>
      <button id="moodBtn" style="margin-top:8px; background:#43cea2; color:#fff; border:none; border-radius:6px; padding:6px 18px; font-size:1em; cursor:pointer;">Check In</button>
    </div>
    <div style="margin:18px 0 0 0; font-size:1.08em; color:#4a4a4a; background:#e0f7fa; border-radius:8px; padding:10px 16px;">
      <b>Affirmation of the Moment:</b>
      <span id="affirmationText" style="display:block;margin:8px 0 0 0;"></span>
      <button id="newAffirmationBtn" style="margin-top:8px; background:#5e60ce; color:#fff; border:none; border-radius:6px; padding:6px 18px; font-size:1em; cursor:pointer;">Show Another</button>
    </div>
    <div style="margin:18px 0 0 0; font-size:1.08em; color:#5e60ce; background:#e0f7fa; border-radius:8px; padding:10px 16px;">
      <b>Need a Breather?</b>
      <button id="breathBtn" style="margin-left:8px; background:#43cea2; color:#fff; border:none; border-radius:6px; padding:6px 18px; font-size:1em; cursor:pointer;">Start Breathing Exercise</button>
    </div>
    <div style="margin:18px 0 0 0; font-size:1.08em; color:#5e60ce; background:#f7f7ff; border-radius:8px; padding:10px 16px;">
      <b>Gratitude Journal</b>
      <button id="gratitudeBtn" style="margin-left:8px; background:#5e60ce; color:#fff; border:none; border-radius:6px; padding:6px 18px; font-size:1em; cursor:pointer;">Write Now</button>
    </div>
    <div id="gratitudeModal">
      <div class="gratitude-popup" style="background:#fff;border-radius:16px;padding:32px 24px;box-shadow:0 4px 24px rgba(94,96,206,0.13);text-align:center;max-width:340px;margin:auto;">
        <h2 style="color:#5e60ce;">Gratitude Journal</h2>
        <textarea id="gratitudeText" rows="4" style="width:90%;border-radius:8px;padding:8px;"></textarea>
        <div id="gratitudeMsg" style="margin:8px 0 0 0;color:#43cea2;"></div>
        <button onclick="closeGratitudeModal()" style="background:#5e60ce;color:#fff;border:none;border-radius:6px;padding:8px 18px;font-size:1em;cursor:pointer;">Close</button>
        <button onclick="saveGratitude()" style="background:#43cea2;color:#fff;border:none;border-radius:6px;padding:8px 18px;font-size:1em;cursor:pointer;margin-left:8px;">Save</button>
      </div>
    </div>
    <div style="margin:24px 0;">
      <label for="soundSelect"><b>Select a Sound:</b></label>
      <select id="soundSelect">
        <option value="stream">Gentle Stream</option>
        <option value="rain">Rain</option>
        <option value="forest">Forest Birds</option>
        <option value="ocean">Ocean Waves</option>
        <option value="night">Night Crickets</option>
        <option value="white">White Noise</option>
        <option value="music">Gentle Piano</option>
      </select>
    </div>
    <audio id="audioPlayer" controls loop style="width:100%">
      <source id="audioSource" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b1b6b7.mp3" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
    <div id="visualizer"></div>
    <div id="soundLabel" style="font-size:0.9em;color:#555;">(Sample: Gentle Stream)</div>
    <!-- Guided Visualization Button -->
    <div style="margin:18px 0 0 0; font-size:1.08em; color:#5e60ce; background:#f7f7ff; border-radius:8px; padding:10px 16px;">
      <b>Guided Visualization</b>
      <button id="visualizeBtn" style="margin-left:8px; background:#43cea2; color:#fff; border:none; border-radius:6px; padding:6px 18px; font-size:1em; cursor:pointer;">Start</button>
    </div>
    <div id="visualizeModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(168,237,234,0.85);z-index:1001;align-items:center;justify-content:center;">
      <div style="background:#fff;border-radius:16px;padding:32px 24px;box-shadow:0 4px 24px rgba(94,96,206,0.13);text-align:center;max-width:340px;margin:auto;">
        <h2 style="color:#5e60ce;">Guided Visualization</h2>
        <div id="visualizeGuide" style="margin:18px 0 0 0;font-size:1.1em;color:#5e60ce;"></div>
        <button onclick="closeVisualizeModal()" style="background:#5e60ce;color:#fff;border:none;border-radius:6px;padding:8px 18px;font-size:1em;cursor:pointer;margin-top:18px;">Close</button>
      </div>
    </div>
    <!-- Interactive: Share Your Favorite Sound -->
    <div style="margin:18px 0 0 0; font-size:1.08em; color:#43cea2; background:#f7f7ff; border-radius:8px; padding:10px 16px;">
      <b>What sound helps you most?</b>
      <input id="favSoundInput" type="text" placeholder="Type a sound or feeling..." style="margin:0 8px 0 8px; border-radius:6px; padding:6px; border:1px solid #b8c0ff;" />
      <button id="favSoundSaveBtn" style="background:#43cea2; color:#fff; border:none; border-radius:6px; padding:6px 18px; font-size:1em; cursor:pointer;">Save</button>
      <span id="favSoundSavedMsg" style="margin-left:12px;color:#5e60ce;"></span>
    </div>
    <!-- MindMate AI Chat (Immersive, Trauma-Informed) -->
    <div id="mindmateChat" style="margin:32px 0 0 0; background:#f7f7ff; border-radius:16px; box-shadow:0 4px 24px rgba(94,96,206,0.09); padding:0 0 18px 0; max-width:480px; margin-left:auto; margin-right:auto;">
      <div style="display:flex;align-items:center;gap:12px;padding:18px 18px 0 18px;">
        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" alt="MindMate avatar" style="width:48px;height:48px;border-radius:50%;background:#e0f7fa;box-shadow:0 2px 8px #a8edea44;" />
        <div style="font-size:1.25em;color:#5e60ce;font-weight:600;">MindMate</div>
      </div>
      <div id="chatWindow" style="max-height:260px;overflow-y:auto;padding:12px 18px 0 18px;"></div>
      <form id="chatForm" style="display:flex;gap:8px;align-items:center;padding:0 18px 0 18px;margin-top:8px;" autocomplete="off">
        <input id="chatInput" type="text" placeholder="Type your thoughts or feelings..." aria-label="Type your message to MindMate" style="flex:1;padding:10px 12px;border-radius:8px;border:1px solid #b8c0ff;font-size:1em;outline:none;" required />
        <button type="submit" style="background:#43cea2;color:#fff;border:none;border-radius:8px;padding:10px 18px;font-size:1em;cursor:pointer;">Send</button>
      </form>
      <div id="typingIndicator" style="padding:0 18px;color:#b8c0ff;font-size:0.98em;display:none;">MindMate is typing...</div>
    </div>
    <!-- MindMate OpenAI API Key Input (for privacy, not stored) -->
    <div id="apiKeySection" style="max-width:480px;margin:18px auto 0 auto;padding:10px 18px;background:#fff3cd;border-radius:10px;color:#856404;font-size:0.98em;box-shadow:0 2px 8px #ffe06633;">
      <b>ðŸ”’ MindMate OpenAI API Key</b><br>
      <span>Enter your OpenAI API key to enable MindMate chat. <b>Your key is never saved or sent anywhere except OpenAI.</b> For privacy, it is only kept in memory and will be forgotten if you reload the page.</span><br>
      <input id="openaiKeyInput" type="password" placeholder="sk-..." style="margin:8px 0 0 0;width:70%;padding:6px 10px;border-radius:6px;border:1px solid #b8c0ff;" />
      <button id="saveKeyBtn" style="background:#43cea2;color:#fff;border:none;border-radius:6px;padding:6px 18px;font-size:1em;cursor:pointer;margin-left:8px;">Save Key</button>
      <span id="keySavedMsg" style="margin-left:12px;color:#43cea2;"></span>
    </div>
  </div>
  <script src="script.js"></script>
  <script>
    // Animated background particles
    const canvas = document.getElementById('particles');
    const ctx = canvas.getContext('2d');
    let w = window.innerWidth, h = window.innerHeight;
    canvas.width = w; canvas.height = h;
    let particles = Array.from({length: 32}, () => ({
      x: Math.random()*w, y: Math.random()*h, r: Math.random()*2+1, dx: (Math.random()-0.5)*0.3, dy: (Math.random()-0.5)*0.3
    }));
    function drawParticles() {
      ctx.clearRect(0,0,w,h);
      ctx.globalAlpha = 0.5;
      for(const p of particles) {
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,2*Math.PI);
        ctx.fillStyle = '#a8edea';
        ctx.fill();
        p.x += p.dx; p.y += p.dy;
        if(p.x<0||p.x>w) p.dx*=-1;
        if(p.y<0||p.y>h) p.dy*=-1;
      }
      requestAnimationFrame(drawParticles);
    }
    drawParticles();
    window.onresize = ()=>{w=window.innerWidth;h=window.innerHeight;canvas.width=w;canvas.height=h;};
    // Affirmations
    const affirmations = [
      "You are enough, just as you are.",
      "You are worthy of love and care.",
      "Your feelings matter.",
      "You are not a burden.",
      "You are allowed to take up space.",
      "You are resilient, even on hard days.",
      "You are not alone in this.",
      "You are doing your best, and that's enough.",
      "You are allowed to rest.",
      "You are brave for facing today.",
      "You are loved, even when you can't feel it.",
      "You are important and your story matters.",
      "You are allowed to feel joy and peace.",
      "You are strong, even when you feel weak.",
      "You are healing, one step at a time.",
      "You are safe in this moment.",
      "You are valued for who you are."
    ];
    // --- Immersive Mood Check-In (AI-powered, simulated) ---
    const moodBtn = document.getElementById('moodBtn');
    const moodText = document.getElementById('moodText');
    const moodPrompts = [
      "How are you feeling right now? (e.g., calm, anxious, hopeful, tired)",
      "What's one word to describe your mood?",
      "Is there something on your mind you'd like to share?"
    ];
    let moodStep = 0;
    moodBtn.onclick = async function() {
      if(moodStep === 0) {
        moodText.innerText = moodPrompts[0];
        moodBtn.innerText = "Next";
        moodStep = 1;
      } else if(moodStep === 1) {
        // Simulate AI empathy response
        const userMood = prompt("How are you feeling?");
        if(userMood) {
          // Simulate API call to AI (replace with real API if available)
          setTimeout(()=>{
            moodText.innerText = `Thank you for sharing. It's okay to feel '${userMood}'. Remember, your feelings are valid and you are not alone.`;
            moodBtn.innerText = "Check In Again";
            moodStep = 0;
          }, 800);
        } else {
          moodText.innerText = "It's okay if you don't want to share right now.";
          moodBtn.innerText = "Check In Again";
          moodStep = 0;
        }
      }
    };
    // --- Guided Visualization (immersive, trauma-informed) ---
    const visualizeBtn = document.getElementById('visualizeBtn');
    const visualizeModal = document.getElementById('visualizeModal');
    const visualizeGuide = document.getElementById('visualizeGuide');
    let vizSteps = [
      "Close your eyes and imagine a gentle stream flowing nearby.",
      "Feel the cool air and hear the soft sounds of water.",
      "Notice the sunlight filtering through the trees.",
      "With each breath, let your worries drift away with the water.",
      "When you're ready, gently open your eyes and return to the present."
    ];
    let vizIdx = 0, vizInterval = null;
    visualizeBtn.onclick = function() {
      visualizeModal.style.display = 'flex';
      vizIdx = 0;
      visualizeGuide.innerText = vizSteps[vizIdx];
      vizInterval = setInterval(()=>{
        vizIdx++;
        if(vizIdx < vizSteps.length) {
          visualizeGuide.innerText = vizSteps[vizIdx];
        } else {
          clearInterval(vizInterval);
        }
      }, 4000);
    };
    window.closeVisualizeModal = function() {
      visualizeModal.style.display = 'none';
      clearInterval(vizInterval);
    };
    // --- Affirmation Glow ---
    const affirmationText = document.getElementById('affirmationText');
    const newAffirmationBtn = document.getElementById('newAffirmationBtn');
    function showAffirmation() {
      const idx = Math.floor(Math.random() * affirmations.length);
      affirmationText.innerText = affirmations[idx];
      affirmationText.classList.add('affirmation-active');
      setTimeout(()=>affirmationText.classList.remove('affirmation-active'), 1800);
    }
    newAffirmationBtn.onclick = showAffirmation;
    showAffirmation();
    // Breathing Exercise
    const breathBtn = document.getElementById('breathBtn');
    const breathModal = document.getElementById('breathModal');
    const breathGuide = document.getElementById('breathGuide');
    let breathInterval = null;
    breathBtn.onclick = function() {
      breathModal.style.display = 'flex';
      let steps = ["Breathe in...", "Hold...", "Breathe out...", "Hold..."];
      let idx = 0;
      breathGuide.innerText = steps[idx];
      breathInterval = setInterval(() => {
        idx = (idx + 1) % steps.length;
        breathGuide.innerText = steps[idx];
      }, 3500);
    };
    window.closeBreathModal = function() {
      breathModal.style.display = 'none';
      clearInterval(breathInterval);
    };
    // Gratitude Journal
    document.getElementById('gratitudeBtn').onclick = function() {
      document.getElementById('gratitudeModal').style.display = 'flex';
      document.getElementById('gratitudeMsg').innerText = '';
      document.getElementById('gratitudeText').value = '';
    };
    window.closeGratitudeModal = function() {
      document.getElementById('gratitudeModal').style.display = 'none';
    };
    window.saveGratitude = function() {
      const val = document.getElementById('gratitudeText').value.trim();
      if(val.length>0) {
        document.getElementById('gratitudeMsg').innerText = 'Saved! Thank you for sharing.';
      } else {
        document.getElementById('gratitudeMsg').innerText = 'Please write something you are grateful for.';
      }
    };
    // Soothing Sounds
    const soundMap = {
      stream: {src: 'https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b1b6b7.mp3', label: 'Gentle Stream'},
      rain: {src: 'https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b7b7b.mp3', label: 'Rain'},
      forest: {src: 'https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b1b6b8.mp3', label: 'Forest Birds'},
      ocean: {src: 'https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b7b7b.mp3', label: 'Ocean Waves'},
      night: {src: 'https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b1b6b9.mp3', label: 'Night Crickets'},
      white: {src: 'https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b7b7b.mp3', label: 'White Noise'},
      music: {src: 'https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b1b6b6.mp3', label: 'Gentle Piano'}
    };
    document.getElementById('soundSelect').onchange = function() {
      const val = this.value;
      document.getElementById('audioSource').src = soundMap[val].src;
      document.getElementById('audioPlayer').load();
      document.getElementById('soundLabel').innerText = '(Sample: ' + soundMap[val].label + ')';
    };
    // Sound Visualizer
    const audio = document.getElementById('audioPlayer');
    const visualizer = document.getElementById('visualizer');
    for(let i=0;i<32;i++){
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.style.height = (Math.random()*24+8)+'px';
      visualizer.appendChild(bar);
    }
    let bars = visualizer.querySelectorAll('.bar');
    setInterval(()=>{
      bars.forEach(bar=>{
        bar.style.height = (Math.random()*24+8)+'px';
      });
    }, 300);
    // Therapist Collaboration: Export Session Notes
    document.getElementById('exportSessionBtn').onclick = function() {
      const favSound = localStorage.getItem('mindcareFavSound') || '';
      const gratitude = document.getElementById('gratitudeText') ? document.getElementById('gratitudeText').value : '';
      const affirmation = document.getElementById('affirmationText').innerText;
      const sessionNotes = `Session Notes:\nFavorite Sound: ${favSound}\nAffirmation: ${affirmation}\nGratitude: ${gratitude}`;
      const blob = new Blob([sessionNotes], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'mindcare-session-notes.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      document.getElementById('exportMsg').innerText = 'Session notes exported!';
      setTimeout(()=>{document.getElementById('exportMsg').innerText='';}, 3000);
    };
    // Interactive: Favorite Sound
    document.getElementById('favSoundSaveBtn').onclick = function() {
      const sound = document.getElementById('favSoundInput').value.trim();
      if(sound) {
        localStorage.setItem('mindcareFavSound', sound);
        document.getElementById('favSoundSavedMsg').innerText = 'Saved!';
      } else {
        document.getElementById('favSoundSavedMsg').innerText = '';
      }
    };
    // --- MindMate OpenAI API Key Logic (placeholder mode) ---
    let openaiApiKey = '';
    document.getElementById('saveKeyBtn').onclick = function() {
      const val = document.getElementById('openaiKeyInput').value.trim();
      if(val.startsWith('sk-') && val.length > 30) {
        openaiApiKey = val;
        document.getElementById('keySavedMsg').innerText = 'Key saved (demo mode: no real AI)';
        setTimeout(()=>{document.getElementById('keySavedMsg').innerText='';}, 3000);
      } else {
        document.getElementById('keySavedMsg').innerText = 'Invalid key';
      }
    };
    // --- MindMate AI Chat Placeholder Logic ---
    const chatWindow = document.getElementById('chatWindow');
    const chatForm = document.getElementById('chatForm');
    const chatInput = document.getElementById('chatInput');
    const typingIndicator = document.getElementById('typingIndicator');

    const supportiveResponses = [
      "I'm here for you. You are not alone.",
      "Thank you for sharing. Your feelings are valid.",
      "It's okay to take things one step at a time.",
      "You are doing your best, and that's enough.",
      "Would you like to try a calming activity or just talk?",
      "Remember to be gentle with yourself today.",
      "If things feel overwhelming, it's okay to pause and breathe.",
      "You are worthy of care and kindness.",
      "If you need more support, consider reaching out to a trusted person or therapist."
    ];

    function addChatBubble(text, sender) {
      const bubble = document.createElement('div');
      bubble.className = sender === 'user' ? 'chat-bubble user' : 'chat-bubble ai';
      bubble.setAttribute('role', 'region');
      bubble.setAttribute('aria-live', 'polite');
      bubble.style.margin = '8px 0';
      bubble.style.maxWidth = '80%';
      bubble.style.padding = '12px 16px';
      bubble.style.borderRadius = sender === 'user' ? '16px 16px 4px 16px' : '16px 16px 16px 4px';
      bubble.style.background = sender === 'user' ? '#e0f7fa' : '#5e60ce';
      bubble.style.color = sender === 'user' ? '#4a4a4a' : '#fff';
      bubble.style.alignSelf = sender === 'user' ? 'flex-end' : 'flex-start';
      bubble.style.boxShadow = '0 2px 8px #a8edea22';
      bubble.innerText = text;
      chatWindow.appendChild(bubble);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // Initial greeting
    if(chatWindow.childElementCount === 0) {
      addChatBubble("Hi, I'm MindMate. How are you feeling today?", 'ai');
    }

    chatForm.onsubmit = function(e) {
      e.preventDefault();
      const userMsg = chatInput.value.trim();
      if(!userMsg) return;
      addChatBubble(userMsg, 'user');
      chatInput.value = '';
      typingIndicator.style.display = 'block';
      chatWindow.scrollTop = chatWindow.scrollHeight;
      setTimeout(()=>{
        typingIndicator.style.display = 'none';
        if(openaiApiKey) {
          addChatBubble("[Demo] No real AI is used. This is a placeholder response.", 'ai');
        } else {
          const idx = Math.floor(Math.random() * supportiveResponses.length);
          addChatBubble(supportiveResponses[idx], 'ai');
        }
      }, 700 + Math.random()*600);
    };
  </script>
  <style>
    /* MindMate Chat Styles */
    #mindmateChat { font-family: inherit; }
    #chatWindow { display: flex; flex-direction: column; gap: 0.5em; min-height: 60px; }
    .chat-bubble.ai { background: #5e60ce; color: #fff; align-self: flex-start; }
    .chat-bubble.user { background: #e0f7fa; color: #4a4a4a; align-self: flex-end; }
    #chatInput:focus { border:2px solid #43cea2; box-shadow:0 0 0 2px #a8edea55; }
    #typingIndicator { font-style: italic; }
  </style>
</body>
</html>
