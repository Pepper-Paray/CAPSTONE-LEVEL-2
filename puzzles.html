<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Puzzles - Mindcare</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="dark" data-theme="dark">
  <canvas id="lavaLamp"></canvas>
  <!-- Immersive Floating Shapes -->
  <div class="floating-shape"></div>
  <div class="floating-shape"></div>
  <div class="floating-shape"></div>
  <canvas id="particles"></canvas>
  <div class="container dark">
    <h1 id="bubbleTitle"></h1>
    <div id="mentalTip" class="dark" style="margin:18px 0 0 0; font-size:1.08em; color:#5e60ce; background:#e0f7fa; border-radius:8px; padding:10px 16px;"></div>
    <div class="tabs dark">
      <a class="tab dark" href="index.html">Home</a>
      <a class="tab dark" href="soothing.html">Soothing Sounds</a>
      <a class="tab active dark" href="#">Puzzles</a>
    </div>
    <div class="dark" style="margin:18px 0 0 0; font-size:1.08em; border-radius:8px; padding:10px 16px;">
      <b class="dark">Welcome to your puzzle space.</b> Enjoy a new set of relaxing jigsaw puzzles every day. Choose your challenge and take your timeâ€”there's no rush!
    </div>
    <div class="dark" style="margin:18px 0 0 0; font-size:1.08em; border-radius:8px; padding:10px 16px;">
      <b class="dark">Affirmation of the Moment:</b>
      <span id="affirmationText" style="display:block;margin:8px 0 0 0;"></span>
      <button id="newAffirmationBtn" class="dark" style="margin-top:8px;">Show Another</button>
    </div>
    <div class="dark" style="margin:18px 0 0 0; font-size:1.08em; border-radius:8px; padding:10px 16px;">
      <b class="dark">Need a Breather?</b>
      <button id="breathBtn" class="dark" style="margin-left:8px;">Start Breathing Exercise</button>
    </div>
    <div class="dark" style="margin:18px 0 0 0; font-size:1.08em; border-radius:8px; padding:10px 16px;">
      <b class="dark">Gratitude Journal</b>
      <button id="gratitudeBtn" class="dark" style="margin-left:8px;">Write Now</button>
    </div>
    <div id="gratitudeModal">
      <div class="gratitude-popup dark">
        <h2 class="dark">Gratitude Journal</h2>
        <textarea id="gratitudeText" rows="4" class="dark"></textarea>
        <div id="gratitudeMsg"></div>
        <button onclick="closeGratitudeModal()" class="dark">Close</button>
        <button onclick="saveGratitude()" class="dark">Save</button>
      </div>
    </div>
    <div style="margin-top:32px;">
      <label for="puzzleSelect"><b class="dark">Choose Your Puzzle:</b></label>
      <select id="puzzleSelect" class="dark"></select>
      <div id="puzzleArea" style="margin-top:16px;"></div>
    </div>
    <div id="freeQuote" class="dark" style="margin:18px 0 0 0; font-size:1.08em; border-radius:8px; padding:10px 16px; background:#232946; color:#a8edea;"></div>
  </div>
  <script src="script.js"></script>
  <script>
    // Bubble Letters Title
    const title = 'Daily Jigsaw Puzzles';
    const bubbleTitle = document.getElementById('bubbleTitle');
    if (bubbleTitle) {
      bubbleTitle.innerHTML = '';
      for(let i=0;i<title.length;i++) {
        const span = document.createElement('span');
        span.className = 'bubble-letter';
        span.innerText = title[i] === ' ' ? '\u00A0' : title[i];
        span.style.animationDelay = (i*0.08)+'s';
        bubbleTitle.appendChild(span);
      }
    }
    // Mental Health Tip API
    fetch('https://mentalhealthapi.vercel.app/api/tip')
      .then(r=>r.json()).then(data=>{
        document.getElementById('mentalTip').innerHTML = '<b>Tip:</b> '+data.tip;
      }).catch(()=>{
        document.getElementById('mentalTip').innerHTML = '<b>Tip:</b> Take a deep breath and remember you are enough!';
      });
    // Daily Puzzle Logic
    const puzzleImages = [
      { url: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80', title: 'Forest Stream' },
      { url: 'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80', title: 'Mountain Lake' },
      { url: 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=400&q=80', title: 'Sunset Beach' },
      { url: 'https://images.unsplash.com/photo-1465101178521-c1a9136a3c5c?auto=format&fit=crop&w=400&q=80', title: 'Wildflowers' },
      { url: 'https://images.unsplash.com/photo-1502082553048-f009c37129b9?auto=format&fit=crop&w=400&q=80', title: 'Calm Ocean' },
      { url: 'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80', title: 'Peaceful Lake' },
      { url: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80', title: 'Misty Forest' },
      { url: 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=400&q=80', title: 'Golden Sunset' }
    ];
    const pieceOptions = [20, 50, 100, 500];
    function getDailySeed() {
      const d = new Date();
      return d.getFullYear()*10000 + (d.getMonth()+1)*100 + d.getDate();
    }
    function seededShuffle(array, seed) {
      let arr = array.slice();
      let m = arr.length, t, i;
      function random() {
        var x = Math.sin(seed++) * 10000;
        return x - Math.floor(x);
      }
      while (m) {
        i = Math.floor(random() * m--);
        t = arr[m];
        arr[m] = arr[i];
        arr[i] = t;
      }
      return arr;
    }
    function getDailyPuzzles() {
      const seed = getDailySeed();
      const shuffled = seededShuffle(puzzleImages, seed);
      return shuffled.slice(0, 4).map((img, idx) => {
        return pieceOptions.map(pieces => ({
          url: img.url,
          title: img.title + ' (' + pieces + ' pieces)',
          pieces
        }));
      }).flat();
    }
    const puzzleSelect = document.getElementById('puzzleSelect');
    const dailyPuzzles = getDailyPuzzles();
    puzzleSelect.innerHTML = '<option value="none">-- Choose --</option>' +
      dailyPuzzles.map((p, i) => `<option value="${i}">${p.title}</option>`).join('');
    puzzleSelect.onchange = function() {
      const idx = this.value;
      const area = document.getElementById('puzzleArea');
      if(idx === 'none') { area.innerHTML = ''; return; }
      const puzzle = dailyPuzzles[idx];
      area.innerHTML = `<iframe src="https://www.jspuzzles.com/?puzzle=${encodeURIComponent(puzzle.url)}&pieces=${puzzle.pieces}" width="100%" height="480" style="border:none;border-radius:12px;box-shadow:0 2px 12px #5e60ce22;"></iframe><div style='margin-top:8px;font-size:1em;color:#5e60ce;'>${puzzle.title}</div>`;
    };
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js');
      });
    }
  </script>
</body>
</html>
